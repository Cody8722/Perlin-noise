<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG 世界生成器</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <h2>RPG 世界生成器 (比例修復版)</h2>
    </header>

    <div class="main-container">
        <!-- 左/上：地圖區 -->
        <div class="viewport-area">
            <div class="map-wrapper">
                <canvas id="terrainLayer" class="layer" width="300" height="200"></canvas>
                <canvas id="cloudLayer" class="layer" width="600" height="200"></canvas>
                <div class="hud" id="hud">Hover info...</div>
            </div>
        </div>

        <!-- 右/下：控制區 -->
        <div class="controls-area">
            <!-- 種子控制區 -->
            <div class="control-group seed-control">
                <label for="inp_seed">🌱 世界種子</label>
                <div class="seed-input-wrapper">
                    <input type="text" id="inp_seed" placeholder="輸入種子或留空隨機生成">
                    <button id="btnGenerate">生成</button>
                </div>
                <div class="seed-display">
                    當前種子: <span id="current_seed">0</span>
                    <button id="btnCopySeed" class="copy-btn" title="複製種子">📋</button>
                    <button id="btnRandomSeed" class="copy-btn" title="隨機種子">🎲</button>
                </div>
            </div>

            <div class="control-group">
                <span class="group-title">視圖模式</span>
                <div class="view-mode-buttons">
                    <button id="btn_biome" class="view-btn active">🌍 生物群系</button>
                    <button id="btn_height" class="view-btn">🏔️ 高度</button>
                    <button id="btn_moisture" class="view-btn">💧 濕度</button>
                    <button id="btn_temperature" class="view-btn">🌡️ 溫度</button>
                    <button id="btn_flux" class="view-btn">🌊 水流</button>
                </div>
            </div>

            <div class="control-group">
                <span class="group-title">核心參數</span>

                <label>縮放 (Scale) <span id="val_scale" class="val">60</span></label>
                <input type="range" id="inp_scale" min="10" max="150" value="60">

                <label>細節 (Octaves) <span id="val_octaves" class="val">5</span></label>
                <input type="range" id="inp_octaves" min="1" max="6" step="1" value="5">
            </div>

            <div class="control-group">
                <span class="group-title">環境設定</span>

                <label>海平面 <span id="val_sea" class="val">0.35</span></label>
                <input type="range" id="inp_sea" min="0.1" max="0.8" step="0.05" value="0.35">

                <label>降雨量 <span id="val_moist" class="val">0</span></label>
                <input type="range" id="inp_moist" min="-0.4" max="0.4" step="0.05" value="0">

                <label>🌡️ 溫度 (冰河期 ↔ 暖化) <span id="val_temp" class="val">0</span></label>
                <input type="range" id="inp_temp" min="-0.5" max="0.5" step="0.05" value="0">
            </div>

            <div class="control-group">
                <span class="group-title">🌊 河流系統 (Phase 8 + 9)</span>

                <label>河流密度 (水滴數) <span id="val_river_density" class="val">10000</span></label>
                <input type="range" id="inp_river_density" min="1000" max="200000" step="1000" value="10000">

                <label>河流顯示閾值 <span id="val_river_threshold" class="val">5</span></label>
                <input type="range" id="inp_river_threshold" min="1" max="50" step="1" value="5">

                <label>💧 灌溉強度（尼羅河效應） <span id="val_irrigation" class="val">1.0</span></label>
                <input type="range" id="inp_irrigation" min="0" max="5" step="0.1" value="1.0">

                <label style="justify-content: flex-start; gap: 10px; margin: 8px 0; font-size: 0.9em;">
                    <input type="checkbox" id="chk_advanced_irrigation" checked>
                    ✨ 進階模式（擴散到河岸）
                </label>

                <button id="btnGenerateRivers" class="view-btn" style="margin-top: 10px; width: 100%;">
                    🌊 生成河流網絡 + 生態回饋
                </button>
            </div>

            <div class="control-group">
                <label style="justify-content: flex-start; gap: 10px; margin:0;">
                    <input type="checkbox" id="chk_clouds" checked>
                    ☁️ 顯示動態雲層
                </label>
            </div>

            <!-- 匯出控制區 -->
            <div class="control-group export-control">
                <button id="btnExport" class="export-btn">📷 匯出地圖 (PNG)</button>
                <div class="export-info">
                    下載檔名會包含種子編號
                </div>
            </div>

            <!-- Phase 17: 配置管理區 -->
            <div class="control-group">
                <span class="group-title">⚙️ 配置管理</span>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px;">
                    <button id="btnSaveConfig" class="view-btn" style="font-size: 0.85em;">💾 保存配置</button>
                    <button id="btnLoadConfig" class="view-btn" style="font-size: 0.85em;">📂 載入配置</button>
                </div>
                <button id="btnResetConfig" class="view-btn" style="margin-top: 8px; width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    ↺ 重置到預設值
                </button>
                <div class="export-info" style="margin-top: 8px; font-size: 0.8em;">
                    💡 配置會自動保存到瀏覽器
                </div>
                <!-- 隱藏的檔案輸入 -->
                <input type="file" id="configFileInput" accept=".json" style="display: none;">
            </div>

            <div class="control-group legend-group">
                <span class="group-title">圖例 (Whittaker 生物群系)</span>
                <div class="legend">
                    <!-- 水域 -->
                    <div class="legend-item"><div class="box" style="background:#44447a"></div> 深海</div>
                    <div class="legend-item"><div class="box" style="background:#3050a0"></div> 海洋</div>
                    <div class="legend-item"><div class="box" style="background:#e9ddc7"></div> 沙灘</div>

                    <!-- 極地/高山 -->
                    <div class="legend-item"><div class="box" style="background:#f0f8ff"></div> 冰原</div>
                    <div class="legend-item"><div class="box" style="background:#aab4aa"></div> 苔原</div>
                    <div class="legend-item"><div class="box" style="background:#fff"></div> 雪地</div>

                    <!-- 寒帶 -->
                    <div class="legend-item"><div class="box" style="background:#3c503c"></div> 針葉林</div>
                    <div class="legend-item"><div class="box" style="background:#b4b4a0"></div> 寒漠</div>

                    <!-- 溫帶 -->
                    <div class="legend-item"><div class="box" style="background:#32783c"></div> 溫帶森林</div>
                    <div class="legend-item"><div class="box" style="background:#78a050"></div> 溫帶草原</div>
                    <div class="legend-item"><div class="box" style="background:#968c64"></div> 灌木叢</div>

                    <!-- 熱帶 -->
                    <div class="legend-item"><div class="box" style="background:#0a3214"></div> 熱帶雨林</div>
                    <div class="legend-item"><div class="box" style="background:#1e5a28"></div> 熱帶森林</div>
                    <div class="legend-item"><div class="box" style="background:#a09650"></div> 莽原</div>
                    <div class="legend-item"><div class="box" style="background:#d4bc8b"></div> 熱沙漠</div>

                    <!-- 特殊 -->
                    <div class="legend-item"><div class="box" style="background:#5e7255"></div> 沼澤</div>
                    <div class="legend-item"><div class="box" style="background:#6e6e6e"></div> 岩石</div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript 模組 -->
    <script type="module" src="js/noise.js"></script>
    <script type="module" src="js/config.js"></script>
    <script type="module" src="js/terrain.js"></script>
    <script type="module" src="js/renderer.js"></script>
    <script type="module" src="js/state-manager.js"></script>
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
